{% extends "base.html" %}

{% block title %}Faculty Dashboard{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-body text-center">
                    <img src="{{ url_for('static', filename='uploads/faculty/' + current_user.photo_path) }}" 
                         class="rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                    <h4>{{ current_user.name }}</h4>
                    <p class="text-muted">{{ current_user.designation }}</p>
                    <p class="text-muted">{{ current_user.department }}</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Your Exams</h5>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createExamModal">
                        Create New Exam
                    </button>
                </div>
                <div class="card-body">
                    {% if exams %}
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Start Time</th>
                                        <th>End Time</th>
                                        <th>Duration</th>
                                        <th>Total Marks</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for exam in exams %}
                                    <tr>
                                        <td>{{ exam.title }}</td>
                                        <td>{{ exam.start_time.strftime('%Y-%m-%d %H:%M') }}</td>
                                        <td>{{ exam.end_time.strftime('%Y-%m-%d %H:%M') }}</td>
                                        <td>{{ exam.duration }} minutes</td>
                                        <td>{{ exam.total_marks }}</td>
                                        <td>
                                            <button class="btn btn-sm btn-info">Edit</button>
                                            <button class="btn btn-sm btn-danger">Delete</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            No exams created yet. Click "Create New Exam" to get started.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Exam Modal -->
<div class="modal fade" id="createExamModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Exam</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createExamForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">Exam Title</label>
                        <input type="text" class="form-control" id="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="startTime" class="form-label">Start Time</label>
                        <input type="datetime-local" class="form-control" id="startTime" required>
                    </div>
                    <div class="mb-3">
                        <label for="endTime" class="form-label">End Time</label>
                        <input type="datetime-local" class="form-control" id="endTime" required>
                    </div>
                    <div class="mb-3">
                        <label for="duration" class="form-label">Duration (minutes)</label>
                        <input type="number" class="form-control" id="duration" required>
                    </div>
                    <div class="mb-3">
                        <label for="totalMarks" class="form-label">Total Marks</label>
                        <input type="number" class="form-control" id="totalMarks" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="createExamBtn">Create Exam</button>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('createExamBtn').addEventListener('click', async function() {
    const form = document.getElementById('createExamForm');
    const formData = {
        title: document.getElementById('title').value,
        description: document.getElementById('description').value,
        start_time: document.getElementById('startTime').value,
        end_time: document.getElementById('endTime').value,
        duration: parseInt(document.getElementById('duration').value),
        total_marks: parseInt(document.getElementById('totalMarks').value)
    };

    try {
        const response = await fetch('/api/exam/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (response.ok) {
            alert('Exam created successfully!');
            window.location.reload();
        } else {
            alert(data.error || 'Failed to create exam');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while creating the exam');
    }
});
</script>
{% endblock %} 